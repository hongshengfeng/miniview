var $=function(id){return "string"==typeof id?document.getElementById(id):id};var Class={create:function(){return function(){this.initialize.apply(this,arguments)}}};var Extend=function(destination,source){for(var property in source){destination[property]=source[property]}};var Bind=function(object,fun){return function(){return fun.apply(object,arguments)}};var BindAsEventListener=function(object,fun){var args=Array.prototype.slice.call(arguments).slice(2);return function(event){return fun.apply(object,[event||window.event].concat(args))}};var CurrentStyle=function(element){return element.currentStyle||document.defaultView.getComputedStyle(element,null)};function addEventHandler(oTarget,sEventType,fnHandler){if(oTarget.addEventListener){oTarget.addEventListener(sEventType,fnHandler,false)}else if(oTarget.attachEvent){oTarget.attachEvent("on"+sEventType,fnHandler)}else{oTarget["on"+sEventType]=fnHandler}};function removeEventHandler(oTarget,sEventType,fnHandler){if(oTarget.removeEventListener){oTarget.removeEventListener(sEventType,fnHandler,false)}else if(oTarget.detachEvent){oTarget.detachEvent("on"+sEventType,fnHandler)}else{oTarget["on"+sEventType]=null}};var Resize=Class.create();Resize.prototype={initialize:function(obj,options){this._obj=$(obj);this._styleWidth=this._styleHeight=this._styleLeft=this._styleTop=0;this._sideRight=this._sideDown=this._sideLeft=this._sideUp=0;this._fixLeft=this._fixTop=0;this._scaleLeft=this._scaleTop=0;this._mxSet=function(){};this._mxRightWidth=this._mxDownHeight=this._mxUpHeight=this._mxLeftWidth=0;this._mxScaleWidth=this._mxScaleHeight=0;this._fun=function(){};var _style=CurrentStyle(this._obj);this._borderX=(parseInt(_style.borderLeftWidth)||0)+(parseInt(_style.borderRightWidth)||0);this._borderY=(parseInt(_style.borderTopWidth)||0)+(parseInt(_style.borderBottomWidth)||0);this._fR=BindAsEventListener(this,this.Resize);this._fS=Bind(this,this.Stop);this.SetOptions(options);this.Max=!!this.options.Max;this._mxContainer=$(this.options.mxContainer)||null;this.mxLeft=Math.round(this.options.mxLeft);this.mxRight=Math.round(this.options.mxRight);this.mxTop=Math.round(this.options.mxTop);this.mxBottom=Math.round(this.options.mxBottom);this.Scale=!!this.options.Scale;this.Ratio=Math.max(this.options.Ratio,0);this.onResize=this.options.onResize},SetOptions:function(options){this.options={Max:false,mxContainer:"",mxLeft:0,mxRight:9999,mxTop:0,mxBottom:9999,Min:false,Scale:false,Ratio:0,onResize:function(){}};Extend(this.options,options||{})},Set:function(resize,side){var resize=$(resize),fun;if(!resize){return}switch(side.toLowerCase()){case "up":fun=this.Up;break;case "down":fun=this.Down;break;case "left":fun=this.Left;break;case "right":fun=this.Right;break;case "left-up":fun=this.LeftUp;break;case "right-up":fun=this.RightUp;break;case "left-down":fun=this.LeftDown;break;default:fun=this.RightDown};addEventHandler(resize,"touchstart",BindAsEventListener(this,this.Start,fun))},Start:function(e,fun,touch){this._fun=fun;this._styleWidth=this._obj.clientWidth;this._styleHeight=this._obj.clientHeight;this._styleLeft=this._obj.offsetLeft;this._styleTop=this._obj.offsetTop;this._sideLeft=e.touches[0].clientX-this._styleWidth;this._sideRight=e.touches[0].clientX+this._styleWidth;this._sideUp=e.touches[0].clientY-this._styleHeight;this._sideDown=e.touches[0].clientY+this._styleHeight;this._fixLeft=this._styleLeft+this._styleWidth;this._fixTop=this._styleTop+this._styleHeight;if(this.Scale){this.Ratio=Math.max(this.Ratio,0)||this._styleWidth/this._styleHeight;this._scaleLeft=this._styleLeft+this._styleWidth/2;this._scaleTop=this._styleTop+this._styleHeight/2};if(this.Max){var mxLeft=this.mxLeft,mxRight=this.mxRight,mxTop=this.mxTop,mxBottom=this.mxBottom;if(!!this._mxContainer){mxLeft=Math.max(mxLeft,0);mxTop=Math.max(mxTop,0);mxRight=Math.min(mxRight,this._mxContainer.clientWidth);mxBottom=Math.min(mxBottom,this._mxContainer.clientHeight)};mxRight=Math.max(mxRight,mxLeft+this._borderX);mxBottom=Math.max(mxBottom,mxTop+this._borderY);this._mxSet=function(){this._mxRightWidth=mxRight-this._styleLeft-this._borderX;this._mxDownHeight=mxBottom-this._styleTop-this._borderY;this._mxUpHeight=Math.max(this._fixTop-mxTop,0);this._mxLeftWidth=Math.max(this._fixLeft-mxLeft,0)};this._mxSet();if(this.Scale){this._mxScaleWidth=Math.min(this._scaleLeft-mxLeft,mxRight-this._scaleLeft-this._borderX)*2;this._mxScaleHeight=Math.min(this._scaleTop-mxTop,mxBottom-this._scaleTop-this._borderY)*2}};addEventHandler(document,"touchmove",this._fR);addEventHandler(document,"touchend",this._fS);e.preventDefault()},Resize:function(e){window.getSelection?window.getSelection().removeAllRanges():document.selection.empty();this._fun(e);with(this._obj.style){width=this._styleWidth+"px";height=this._styleHeight+"px";top=this._styleTop+"px";left=this._styleLeft+"px"}this.onResize()},Up:function(e){this.RepairY(this._sideDown-e.touches[0].clientY,this._mxUpHeight);this.RepairTop()},Down:function(e){this.RepairY(e.touches[0].clientY-this._sideUp,this._mxDownHeight)},Right:function(e){this.RepairX(e.touches[0].clientX-this._sideLeft,this._mxRightWidth)},Left:function(e){this.RepairX(this._sideRight-e.touches[0].clientX,this._mxLeftWidth);this.RepairLeft()},RightDown:function(e){this.RepairAngle(e.touches[0].clientX-this._sideLeft,this._mxRightWidth,e.touches[0].clientY-this._sideUp,this._mxDownHeight)},RightUp:function(e){this.RepairAngle(e.touches[0].clientX-this._sideLeft,this._mxRightWidth,this._sideDown-e.touches[0].clientY,this._mxUpHeight);this.RepairTop()},LeftDown:function(e){this.RepairAngle(this._sideRight-e.touches[0].clientX,this._mxLeftWidth,e.touches[0].clientY-this._sideUp,this._mxDownHeight);this.RepairLeft()},LeftUp:function(e){this.RepairAngle(this._sideRight-e.touches[0].clientX,this._mxLeftWidth,this._sideDown-e.touches[0].clientY,this._mxUpHeight);this.RepairTop();this.RepairLeft()},RepairX:function(iWidth,mxWidth){iWidth=this.RepairWidth(iWidth,mxWidth);if(this.Scale){var iHeight=this.RepairScaleHeight(iWidth);if(this.Max&&iHeight>this._mxScaleHeight){iHeight=this._mxScaleHeight;iWidth=this.RepairScaleWidth(iHeight)}else if(this.Min&&iHeight<this.minHeight){var tWidth=this.RepairScaleWidth(this.minHeight);if(tWidth<mxWidth){iHeight=this.minHeight;iWidth=tWidth}}this._styleHeight=iHeight;this._styleTop=this._scaleTop-iHeight/2}this._styleWidth=iWidth},RepairY:function(iHeight,mxHeight){iHeight=this.RepairHeight(iHeight,mxHeight);if(this.Scale){var iWidth=this.RepairScaleWidth(iHeight);if(this.Max&&iWidth>this._mxScaleWidth){iWidth=this._mxScaleWidth;iHeight=this.RepairScaleHeight(iWidth)}this._styleWidth=iWidth;this._styleLeft=this._scaleLeft-iWidth/2}this._styleHeight=iHeight},RepairAngle:function(iWidth,mxWidth,iHeight,mxHeight){iWidth=this.RepairWidth(iWidth,mxWidth);if(this.Scale){iHeight=this.RepairScaleHeight(iWidth);if(this.Max&&iHeight>mxHeight){iHeight=mxHeight;iWidth=this.RepairScaleWidth(iHeight)}else if(this.Min&&iHeight<this.minHeight){var tWidth=this.RepairScaleWidth(this.minHeight);if(tWidth<mxWidth){iHeight=this.minHeight;iWidth=tWidth}}}else{iHeight=this.RepairHeight(iHeight,mxHeight)}this._styleWidth=iWidth;this._styleHeight=iHeight},RepairTop:function(){this._styleTop=this._fixTop-this._styleHeight},RepairLeft:function(){this._styleLeft=this._fixLeft-this._styleWidth},RepairHeight:function(iHeight,mxHeight){iHeight=Math.min(this.Max?mxHeight:iHeight,iHeight);iHeight=Math.max(this.Min?this.minHeight:iHeight,iHeight,0);return iHeight},RepairWidth:function(iWidth,mxWidth){iWidth=Math.min(this.Max?mxWidth:iWidth,iWidth);return iWidth},RepairScaleHeight:function(iWidth){return Math.max(Math.round((iWidth+this._borderX)/this.Ratio-this._borderY),0)},RepairScaleWidth:function(iHeight){return Math.max(Math.round((iHeight+this._borderY)*this.Ratio-this._borderX),0)},Stop:function(){removeEventHandler(document,"touchmove",this._fR);removeEventHandler(document,"touchend",this._fS)}};